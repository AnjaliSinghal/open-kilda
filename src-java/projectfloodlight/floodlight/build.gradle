plugins {
    id 'java'
    id 'org.ajoberstar.grgit' version '4.0.1'
}

group = 'org.projectfloodlight'

import org.ajoberstar.grgit.Grgit

task cloneFloodlightRepo {
    def repo = file("floodlight")
    outputs.dir(repo)

    if (repo.exists()) {
        def grgit = Grgit.open(currentDir: repo.absolutePath)
        grgit.checkout(branch: 'STABLE')
        grgit.pull(rebase: false)
    } else {
        Grgit.clone(dir: repo.absolutePath, uri: 'https://github.com/kilda/floodlight.git', refToCheckout: 'STABLE')
    }
}

task compileMavenProject(type: Exec) {
    workingDir 'floodlight'
    commandLine '/usr/bin/mvn', '-B', 'clean', 'compile'
    dependsOn 'cloneFloodlightRepo'
    outputs.dir('floodlight/target/classes')
}

sourceSets {
    main {
        output.dir('floodlight/target/classes', builtBy: 'compileMavenProject')
    }
}
